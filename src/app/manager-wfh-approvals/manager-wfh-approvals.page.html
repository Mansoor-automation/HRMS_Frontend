<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button (click)="goBack()" defaultHref="/my-team"></ion-back-button>
        </ion-buttons>

        <ion-title>WFH Approvals</ion-title>

        <ion-buttons slot="end">
            <ion-button (click)="loadPendingWFHRequests()">
                <ion-icon name="refresh" slot="icon-only"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>

    <!-- Search -->
    <ion-toolbar>
        <ion-searchbar placeholder="Search employee..." (ionInput)="onSearchChange($event)" [debounce]="300">
        </ion-searchbar>
    </ion-toolbar>

    <!-- Mode Filter -->
    <!-- <ion-toolbar>
        <ion-segment [(ngModel)]="modeFilter" (ionChange)="onModeFilterChange($event)">
            <ion-segment-button value="all">
                <ion-label>All</ion-label>
            </ion-segment-button>
            <ion-segment-button value="WFH">
                <ion-label>WFH</ion-label>
            </ion-segment-button>
            <ion-segment-button value="WFO">
                <ion-label>WFO</ion-label>
            </ion-segment-button>
        </ion-segment>
    </ion-toolbar> -->
</ion-header>

<ion-content>
    <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <!-- Loading -->
    <div *ngIf="isLoading" class="loading-container">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Loading pending WFH requests...</p>
    </div>

      <!-- Empty State -->
      <ion-row class="no-leaves" *ngIf="!isLoading && filteredRequests.length === 0">
        <ion-col size="12" class="ion-text-center">
          <img src="../../../../assets/no_leavedata_img.svg">
          <p class="no-data-text">
               No Pending Requests.</p>
        </ion-col>
      </ion-row>

    <!-- Cards -->
    <div class="requests-container" *ngIf="!isLoading && filteredRequests.length > 0">
        <ion-card *ngFor="let request of filteredRequests" class="wfh-card">

            <ion-card-header>
                <div class="card-header-content row-space-between">
                    <div class="row-left">
                        <ion-avatar class="employee-avatar mr-8">
                                <img [src]="getProfileImage(request)" />
                            </ion-avatar>
                        <div class="employee-info">
                                <ion-card-title>
                                    {{ request.FirstName }} {{ request.LastName }}
                                </ion-card-title>
                                <p class="employee-number">{{ request.EmployeeNumber }}</p>
                            </div>
                    </div>     
                    <div class="badges">
                        <!-- <ion-badge [color]="getModeColor(request.work_mode)">
                            <ion-icon [name]="getModeIcon(request.work_mode)"></ion-icon>
                            {{ request.work_mode }}
                        </ion-badge> -->

                        <ion-badge [ngClass]="getStatusColor(request.status)">
                            {{ request.status || 'pending' }}
                        </ion-badge>
                    </div>
                </div>
            </ion-card-header>

            <ion-card-content>
                <!-- Dates -->
                <div class="row-space-between">
                    <div>
                        <label>Start Date</label>
                        <p>{{ request.start_date | date }}</p>
                    </div>
                    <div>
                        <label>End Date</label>
                        <p>{{ request.end_date | date }}</p>
                    </div>
                    <div>
                            <label>Requested On</label>
                            <p>{{ request.created_at | date }}</p>
                        </div>
                        <div>
                                <label>Duration</label>
                                <p>{{ request.total_days }}</p>
                            </div>
                </div>

                <!-- Mode -->
                <!-- <div class="info-row">
                    <ion-icon [name]="getModeIcon(request.work_mode)"></ion-icon>
                    <div>
                        <label>Work Mode:</label>
                        <p>{{ request.leave_type }}</p>
                    </div>
                </div> -->

                <!-- Reason -->
                <div class="info-row" *ngIf="request.reason">
                    <div>
                        <label>Reason</label>
                        <p>{{ request.reason }}</p>
                    </div>
                </div>

                

                <!-- Actions -->
                <div class="row-right">                    
                    <ion-button class="primary-outline-btn" (click)="rejectWFH(request)">
                            Reject
                        </ion-button>
                    <ion-button class="primary-btn" (click)="approveWFH(request)">
                        Approve
                    </ion-button>
                </div>

            </ion-card-content>
        </ion-card>
    </div>
</ion-content>